<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Encryption and Decryption"><meta name="keywords" content="rust, rustlang, rust-lang, ContextS_Seal"><title>ContextS_Seal in hpke - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="sidebar-items.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../hpke/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../hpke/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><div class="sidebar-elems"><h2 class="location"><a href="index.html">In hpke</a></h2></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../hpke/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1">
                                <a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Function <a href="index.html">hpke</a>::<wbr><a class="fn" href="#">ContextS_Seal</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/hpke/hpke.rs.html#703-714">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust fn"><code>pub fn ContextS_Seal(<br>&nbsp;&nbsp;&nbsp;&nbsp;aead_id: <a class="enum" href="../hpke_aead/enum.AEAD.html" title="enum hpke_aead::AEAD">AEAD</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;context: (<a class="type" href="../hpke_aead/type.Key.html" title="type hpke_aead::Key">Key</a>, <a class="type" href="../hpke_aead/type.Nonce.html" title="type hpke_aead::Nonce">Nonce</a>, <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u32.html">u32</a>, ByteSeq), <br>&nbsp;&nbsp;&nbsp;&nbsp;aad: &amp;ByteSeq, <br>&nbsp;&nbsp;&nbsp;&nbsp;pt: &amp;ByteSeq<br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="type" href="type.Ciphertext.html" title="type hpke::Ciphertext">Ciphertext</a>, (<a class="type" href="../hpke_aead/type.Key.html" title="type hpke_aead::Key">Key</a>, <a class="type" href="../hpke_aead/type.Nonce.html" title="type hpke_aead::Nonce">Nonce</a>, <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u32.html">u32</a>, ByteSeq)), <a class="enum" href="../hpke_errors/enum.HpkeError.html" title="enum hpke_errors::HpkeError">HpkeError</a>&gt;</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h3 id="encryption-and-decryption"><a href="#encryption-and-decryption">Encryption and Decryption</a></h3>
<p>HPKE allows multiple encryption operations to be done based on a
given setup transaction.  Since the public-key operations involved
in setup are typically more expensive than symmetric encryption or
decryption, this allows applications to amortize the cost of the
public-key operations, reducing the overall overhead.</p>
<p>In order to avoid nonce reuse, however, this encryption must be
stateful. Each of the setup procedures above produces a role-specific
context object that stores the AEAD and Secret Export parameters.
The AEAD parameters consist of:</p>
<ul>
<li>The AEAD algorithm in use</li>
<li>A secret <code>key</code></li>
<li>A base nonce <code>base_nonce</code></li>
<li>A sequence number (initially 0)</li>
</ul>
<p>The Secret Export parameters consist of:</p>
<ul>
<li>The HPKE ciphersuite in use</li>
<li>An <code>exporter_secret</code> used for the Secret Export interface; see <a href="fn.Context_Export.html" title="Context_Export"><code>Context_Export</code></a>.</li>
</ul>
<p>All these parameters except the AEAD sequence number are constant.
The sequence number provides nonce uniqueness: The nonce used for
each encryption or decryption operation is the result of XORing
<code>base_nonce</code> with the current sequence number, encoded as a big-endian
integer of the same length as <code>base_nonce</code>. Implementations MAY use a
sequence number that is shorter than the nonce length (padding on the left
with zero), but MUST raise an error if the sequence number overflows. The AEAD
algorithm produces ciphertext that is Nt bytes longer than the plaintext.
Nt = 16 for AEAD algorithms defined in this document.</p>
<p>Encryption is unidirectional from sender to recipient. The sender’s
context can encrypt a plaintext <code>pt</code> with associated data <code>aad</code> as
follows:</p>
<div class="example-wrap"><pre class="language-text"><code>def ContextS.Seal(aad, pt):
  ct = Seal(self.key, self.ComputeNonce(self.seq), aad, pt)
  self.IncrementSeq()
  return ct</code></pre></div>
<p>The sender’s context MUST NOT be used for decryption. Similarly, the recipient’s
context MUST NOT be used for encryption. Higher-level protocols re-using the HPKE
key exchange for more general purposes can derive separate keying material as
needed using use the Secret Export interface; see <a href="fn.Context_Export.html" title="Context_Export"><code>Context_Export</code></a> and
<a href="index.html#bidirectional-encryption">Bidirectional Encryption</a> for more details.</p>
<p>It is up to the application to ensure that encryptions and decryptions are
done in the proper sequence, so that encryption and decryption nonces align.
If <a href="fn.ContextS_Seal.html" title="ContextS_Seal()"><code>ContextS_Seal()</code></a> or <a href="fn.ContextR_Open.html" title="ContextR_Open()"><code>ContextR_Open()</code></a> would cause the <code>seq</code> field to
overflow, then the implementation MUST fail with an error. (In the pseudocode
<code>Context&lt;ROLE&gt;.IncrementSeq()</code> fails with an error when <code>seq</code> overflows,
which causes <a href="fn.ContextS_Seal.html" title="ContextS_Seal()"><code>ContextS_Seal()</code></a> and <a href="fn.ContextR_Open.html" title="ContextR_Open()"><code>ContextR_Open()</code></a> to fail accordingly.)
Note that the internal <code>Seal()</code> and <code>Open()</code>
calls inside correspond to the context’s <a href="../hpke_aead/enum.AEAD.html" title="AEAD"><code>AEAD</code></a> algorithm.</p>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="hpke" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0-nightly (495b21669 2022-07-03)" ></div>
</body></html>